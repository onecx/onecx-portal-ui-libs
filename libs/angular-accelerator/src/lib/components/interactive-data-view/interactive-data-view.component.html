<div class="p-3 border-bottom-1 surface-border" [ngClass]="headerStyleClass()" id="interactiveDataViewHeader">
  <div class="flex flex-wrap justify-content-between align-items-center py-1 gap-2">
    <div class="flex flex-wrap justify-content-start align-items-center gap-2">
      <ocx-data-layout-selection
        [supportedViewLayouts]="supportedViewLayouts()"
        [layout]="layout()"
        (dataViewLayoutChange)="onDataViewLayoutChange($event)"
        (componentStateChanged)="dataLayoutComponentState$.next($event)"
      ></ocx-data-layout-selection>
      @if (!disableFilterView()) {
      <ocx-filter-view
        [filters]="filters()"
        [columns]="columns()"
        [templates]="templates()"
        [displayMode]="filterViewDisplayMode()"
        [selectDisplayedChips]="selectDisplayedChips()"
        [chipStyleClass]="filterViewChipStyleClass()"
        [tableStyle]="filterViewTableStyle()"
        (filtered)="filtering($event)"
        (componentStateChanged)="filterViewComponentState$.next($event)"
      ></ocx-filter-view>
      }
    </div>

    @if (_topCenter(); as topCenterTemplate) {
    <div>
      <ng-container [ngTemplateOutlet]="topCenterTemplate"> </ng-container>
    </div>
    } @if (layout() !== 'table') {
    <div class="flex align-items-center gap-2">
      <ocx-data-list-grid-sorting
        [sortDirection]="sortDirection()"
        [sortField]="sortField()"
        [columns]="displayedColumns()"
        [sortStates]="sortStates()"
        (sortChange)="onSortChange($event)"
        (sortDirectionChange)="onSortDirectionChange($event)"
        (componentStateChanged)="dataListGridSortingComponentState$.next($event)"
      ></ocx-data-list-grid-sorting>
    </div>
    }

    <div
      [ngStyle]="layout() !== 'table' ? {
      'position': 'absolute'
    } : {}"
      class="flex flex-wrap justify-content-between align-items-center gap-2"
    >
      @if (isColumnGroupSelectionComponentDefined() ?? true) {
      <ocx-slot
        [ngStyle]="layout() !== 'table' ? {'display' : 'none'}  : {}"
        *ocxIfPermission="searchConfigPermission(); elseTemplate: defaultColumnGroupSelectionComponent"
        name="{{columnGroupSlotName}}"
        [inputs]="{ placeholderKey: groupSelectionNoGroupSelectedKey(), defaultGroupKey: defaultGroupKey(), customGroupKey: customGroupKey(), columns: columns(), selectedGroupKey: selectedGroupKey(), layout: layout(), displayedColumnsIds: displayedColumnKeys() }"
        [outputs]="{ groupSelectionChanged: slotGroupSelectionChangeListener }"
      >
        <ng-template #skeleton>
          <div class="flex">
            <p-skeleton width="18rem" height="3rem"></p-skeleton>
          </div>
        </ng-template>
      </ocx-slot>
      } @else {
      <ng-container [ngTemplateOutlet]="defaultColumnGroupSelectionComponent"></ng-container>
      } @if (layout() === 'table') {
      <ocx-custom-group-column-selector
        [columns]="columns()"
        [displayedColumns]="displayedColumns()"
        [customGroupKey]="customGroupKey()"
        (columnSelectionChanged)="onColumnSelectionChange($event)"
        [frozenActionColumn]="frozenActionColumn()"
        [actionColumnPosition]="actionColumnPosition()"
        (actionColumnConfigChanged)="onActionColumnConfigChange($event)"
        (componentStateChanged)="customGroupColumnSelectorComponentState$.next($event)"
      ></ocx-custom-group-column-selector>
      }
    </div>
  </div>
</div>
<div class="p-3" [ngClass]="contentStyleClass()" id="interactiveDataViewContent">
  <ocx-data-view
    [columns]="displayedColumns()"
    [sortStates]="sortStates()"
    [sortField]="sortField()"
    [filters]="filters()"
    [data]="data()"
    [sortDirection]="sortDirection()"
    [titleLineId]="titleLineId()"
    [subtitleLineIds]="subtitleLineIds()"
    [clientSideSorting]="clientSideSorting()"
    [clientSideFiltering]="clientSideFiltering()"
    [pageSizes]="pageSizes()"
    [pageSize]="pageSize()"
    [emptyResultsMessage]="emptyResultsMessage()"
    [layout]="layout()"
    [name]="name()"
    [deletePermission]="deletePermission()"
    [editPermission]="editPermission()"
    [viewPermission]="viewPermission()"
    [deleteActionEnabledField]="deleteActionEnabledField()"
    [deleteActionVisibleField]="deleteActionVisibleField()"
    [editActionEnabledField]="editActionEnabledField()"
    [editActionVisibleField]="editActionVisibleField()"
    [viewActionEnabledField]="viewActionEnabledField()"
    [viewActionVisibleField]="viewActionVisibleField()"
    [additionalActions]="additionalActions()"
    [listGridPaginator]="listGridPaginator()"
    [tablePaginator]="tablePaginator()"
    [page]="page()"
    (pageChanged)="onPageChange($event)"
    (pageSizeChanged)="onPageSizeChange($event)"
    [selectedRows]="selectedRows()"
    [frozenActionColumn]="frozenActionColumn()"
    [actionColumnPosition]="actionColumnPosition()"
    [stringTableCellTemplate]="_stringTableCell()"
    [numberTableCellTemplate]="_numberTableCell()"
    [dateTableCellTemplate]="_dateTableCell()"
    [relativeDateTableCellTemplate]="_relativeDateTableCell()"
    [tableCellTemplate]="_tableCell()"
    [translationKeyTableCellTemplate]="_translationKeyTableCell()"
    [gridItemSubtitleLinesTemplate]="_gridItemSubtitleLines()"
    [listItemSubtitleLinesTemplate]="_listItemSubtitleLines()"
    [listItemTemplate]="_listItem()"
    [listValueTemplate]="_listValue()"
    [translationKeyListValueTemplate]="_translationKeyListValue()"
    [numberListValueTemplate]="_numberListValue()"
    [relativeDateListValueTemplate]="_relativeDateListValue()"
    [stringListValueTemplate]="_stringListValue()"
    [dateListValueTemplate]="_dateListValue()"
    [gridItemTemplate]="_gridItem()"
    [tableFilterCellTemplate]="_tableFilterCell()"
    [dateTableFilterCellTemplate]="_dateTableFilterCell()"
    [numberTableFilterCellTemplate]="_numberTableFilterCell()"
    [stringTableFilterCellTemplate]="_stringTableFilterCell()"
    [relativeDateTableFilterCellTemplate]="_relativeDateTableFilterCell()"
    [translationKeyTableFilterCellTemplate]="_translationKeyTableFilterCell()"
    (sorted)="sorting($event)"
    (filtered)="filtering($event)"
    [totalRecordsOnServer]="totalRecordsOnServer()"
    [currentPageShowingKey]="currentPageShowingKey()"
    [currentPageShowingWithTotalOnServerKey]="currentPageShowingWithTotalOnServerKey()"
    (componentStateChanged)="dataViewComponentState$.next($event)"
    [parentTemplates]="templates()"
    [tableAllowSelectAll]="tableAllowSelectAll()"
    [tableSelectionEnabledField]="tableSelectionEnabledField()"
  >
  </ocx-data-view>
</div>

<ng-template #defaultColumnGroupSelectionComponent>
  @if (layout() === 'table') {
  <ocx-column-group-selection
    [selectedGroupKey]="selectedGroupKey() ?? defaultGroupKey()"
    [columns]="columns()"
    [defaultGroupKey]="defaultGroupKey() !== customGroupKey() ? defaultGroupKey() : ''"
    [customGroupKey]="customGroupKey()"
    [placeholderKey]="groupSelectionNoGroupSelectedKey()"
    (groupSelectionChanged)="onColumnGroupSelectionChange($event)"
    (componentStateChanged)="columnGroupSelectionComponentState$.next($event)"
  ></ocx-column-group-selection>
  }
</ng-template>
